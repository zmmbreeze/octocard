/*!
 octocard
 1.2.0
 23-11-2014
*/
!function(){var a=/(\d{4})-(\d{2})-(\d{2})T/,b={createStyle:function(a){var b=document.createElement("style");return b.type="text/css",b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a)),b},format:function(a,b,c){if(!b)return a;var d;if("object"!=typeof b){var e=c?b:"#{v}";return d=c||b,a.replace(new RegExp(e,"g"),""+d)}var f=b;return a.replace(c||/#\{([^{}]+)\}/g,function(a,b){return d=f[b],null==d?"":""+d})},jsonp:function(a,b,c){var d,e=document.createElement("script"),f="githubcardjsonp"+(new Date).getTime(),g=5e4,h=0,i=!1,j=a.match(/[?&]callback=([^$&]+)/);e.src=j?a.replace(/([?&]callback=)[^$&]+/,"$1"+f):a+(-1===a.indexOf("?")?"?":"&")+"callback="+f,e.type="text/javascript",e.charset="UTF-8",window[f]=function(a){return a.success?(i=!0,b(a.data),window[f]=null,void 0):(c(a.message),i=!0,void 0)};var k=function(){!i&&c&&c("Server or network error."),e.onload=e.onreadystatechange=null,document.body.removeChild(e)};e.onload=e.onreadystatechange=function(){if(!h){var a=e.readyState;("undefined"==typeof a||"loaded"==a||"complete"==a)&&(h=1,k(),clearTimeout(d))}},d=setTimeout(function(){k(),window[f]=function(){}},g),document.body.appendChild(e)},bind:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},resetTime:function(a){return a.setMilliseconds(0),a.setMinutes(0),a.setHours(0),a.setSeconds(0),a},today:function(){return b.resetTime(new Date)},nextDay:function(a){return new Date(a.getTime()+864e5)},tomorrow:function(){return b.nextDay(b.today())},strToDate:function(b){var c=b.match(a);return new Date(c[1],c[2]-1,c[3],0,0,0,0)},getPageHeight:function(a){var b="scrollHeight",c="offsetHeight",d=a.documentElement,e=a.body;return Math.max(e[b],e[c],d[b],d[c])},getShadowRoot:function(a){for(var b,c=["","webkit","moz","ms"],d=0,e=c.length;e>d;d++)if(b=this._getShadowRoot(a,c[d]))return b},_getShadowRoot:function(a,c){var d="createShadowRoot",e="shadowRoot";if(c&&(d=c+b.capitalize(d),e=c+b.capitalize(e)),"function"==typeof a[d]){var f=a[e];return f?(f.innerHTML="",f):(f=a[d](),f.resetStyleInheritance=!0,f)}},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},addSizeClass:function(a,b){for(var c,d,e=a.offsetWidth,f=[0,240,480],g={480:"octocard-max",240:"octocard-mid",0:"octocard-min"},h=0;h<f.length&&(d=f[h],c=f[h+1],!(e>=d&&(c>e||!c)));h++);b.getAttribute("data-rule")!=d&&(b.className=b.className.replace(/(^| )octocard\-m[^ $]+/,"")+" "+g[d],b.setAttribute("data-rule",d))}},c='<div class="octocard-loading-inner"><div class="octocard-loading-0"></div><div class="octocard-loading-1"></div><div class="octocard-loading-2"></div></div>',d=function(a,b){this.element=a;var d=document.createElement("div");d.style.zIndex=b||9,d.className="octocard-loading",this.element.appendChild(d),this.root=d,d.innerHTML=c,this.highlightNum=2,this.start()};d.prototype.start=function(){var a=this.root.firstChild.childNodes,b=this;this.timer=setInterval(function(){var c=b.highlightNum;a[c].className="octocard-loading-"+c,b.highlightNum=c=(c+1)%3,a[c].className="octocard-loading-"+c+" octocard-loading-cur"},500)},d.prototype.stop=function(){clearInterval(this.timer)},d.prototype.end=function(){this.stop(),this.root&&(this.element.removeChild(this.root),delete this.root)};var e=function(a,b){return new d(a,b)},f={mods:{},get:function(a){return this.mods[a]},add:function(a,b){this.mods[a]=b}},g=function(a,c){var d=a.data.base;d.name&&d.name!==d.login?d._login=d.login:(d.name=d.name||d.login,d._nameClass="octocard-m-base-noname");var e=b.format(g.MOD_HTML,a.data.base);a.appendModHTML("base",e),c()};g.MOD_HTML='<a href="#{html_url}" target="_blank"><img src="#{avatar_url}" width="44" height="44"/><h1 class="#{_nameClass}">#{name}</h1><span>#{_login}</span></a>',f.add("base",g);var h=function(a,b){var c=a.data.base;if(c.email||c.blog||c.bio||c.location||c.company){var d="<ul>"+(c.email?"<li>"+c.email+"</li>":"")+(c.blog?'<li><a href="'+c.blog+'" target="_blank">'+c.blog+"</a></li>":"")+(c.bio?"<li>"+c.bio+"</li>":"")+(c.location?"<li>"+c.location+"</li>":"")+(c.company?"<li>"+c.company+"</li>":"")+"</ul>";a.appendModHTML("details",d)}b()};f.add("details",h);var i=function(a,c){var d=a.data.eventsStatis;if(0===d.length)return c(),void 0;for(var e,f,g,h=0,j=d.length-1,k=[],l=function(a){for(f=new Date(864e5+f.getTime());a>f;)k.push({date:f,counter:0}),f=new Date(864e5+f.getTime())};j>=0&&(e=d[j],h=Math.max(h,e.counter),f=b.strToDate(e.date),k.push({date:f,counter:e.counter}),0!==j);j--)g=b.strToDate(d[j-1].date),l(g);var m=b.tomorrow();l(m);var n="";j=k.length-1;for(var o=100/(j+1);j>=0;j--)e=k[j],n+=b.format(i.MOD_BAR_HTML,{date:e.date.toDateString(),counter:e.counter,width:o,height:100*(e.counter/h),visibility:e.counter?"visible":"hidden"});a.appendModHTML("eventsStatis",b.format(i.MOD_HTML,{map:n})),c()};i.MOD_HTML='<h2>Events</h2><div class="octocard-m-eventsstatis-bd">#{map}</div><div class="octocard-m-eventsstatis-date"><span class="octocard-m-eventsstatis-date-end">Now</span></div>',i.MOD_BAR_HTML='<div class="octocard-m-eventsstatis-bar" style="width:#{width}%;"><div style="height:#{height}%;visibility:#{visibility};">#{date} - #{counter}</div></div>',f.add("eventsStatis",i);var j=function(a,b){var c=a.config.noFooter;if(c&&"false"!==c)return b(),void 0;var d=document.createElement("a");d.href="http://octocard.in/",d.target="_blank",d.className="octocard-footer",d.innerHTML="Octocard.in",a.element.appendChild(d),b()};f.add("footer",j);var k=function(a,c){var d=a.data.orgs;if(0===d.length)return c(),void 0;var e=parseInt(a.config.orgsNum,10)||-1;e>=0&&(d=d.slice(0,e));for(var f="",g=0,h=d.length;h>g;g++)f+=b.format(k.MOD_LI_HTML,d[g]);a.appendModHTML("orgs",b.format(k.MOD_HTML,f)),c()};k.MOD_HTML="<h2>Organizations</h2><ul>#{v}</ul>",k.MOD_LI_HTML='<li><a href="https://github.com/#{login}" target="_blank" title="#{login}"><img src="#{avatar_url}" alt="#{login}" height="32" width="32" /></a></li>',f.add("orgs",k);var l=function(a,c){var d,e;if(data=a.data.repos,0===data.length)return c(),void 0;data.sort(function(a,b){return b.watchers_count-a.watchers_count});var f=a.config.reposIgnored,g={};if(f)for(f=f.split(","),d=0,e=f.length;e>d;d++)g[f[d]]=1;var h,i=parseInt(a.config.reposNum,10)||3,j="<ul>";for(d=0,h=0,e=data.length;e>d&&h!==i;d++)g[data[d].name]||(h++,j+=b.format(l.MOD_LI_HTML,data[d]));j+="</ul>",a.appendModHTML("repos",j),c()};l.MOD_LI_HTML='<li><a href="#{html_url}" target="_blank"><h2>#{name}</h2><p>#{description}</p><span>#{watchers_count}&#10029;</span></a></li>',f.add("repos",l);var m=function(a,c){var d=b.format(m.MOD_HTML,a.data.base);a.appendModHTML("stats",d),c()};m.MOD_HTML='<ul><li><a target="_blank" href="#{html_url}/followers"><strong>#{followers}</strong><span>followers</span></a></li><li><a target="_blank" href="#{html_url}/following"><strong>#{following}</strong><span>following</span></a></li><li><a target="_blank" href="#{html_url}?tab=repositories"><strong>#{public_repos}</strong><span>repos</span></a></li><li><a target="_blank" href="https://gist.github.com/#{login}"><strong>#{public_gists}</strong><span>gists</span></a></li></ul>',f.add("stats",m);var n=function(a){this.reload(a)};n.prototype.reload=function(a){if(this.host&&(this.host.innerHTML=""),a=a||{},this.config=a,a.api=a.api||"http://octocard.in/api",this.element=a.element||"octocard","string"==typeof this.element?(this.elementId=this.element,this.element=document.getElementById(this.element),this.element||(this.element=document.createElement("div"),this.element.id=this.elementId,q.parentNode.insertBefore(this.element,q))):this.element.id?this.elementId=this.element.id:(this.elementId="octocard"+(new Date).getTime(),this.element.id=this.elementId),this.host=this.element,a.noIsolated&&"false"!==a.noIsolated||this._createContainer(),this._bindSizeClass(),"undefined"==typeof THEME_CSS)throw new Error("Theme css not found!");var b=this.createStyle(THEME_CSS);this.element.appendChild(b),this.username=a.name;var c=a.modules||"base,details,stats,repos,eventsStatis,orgs";c=c.split(","),c.unshift("footer"),this.setupModules(c)},n.prototype._showErrorMsg=function(a,c){var d=document.createElement("div");d.className="octocard-error",d.innerHTML=a;var e=document.createElement("a");e.href="javascript:void(0)",e.innerHTML="Refresh";var f=this;b.bind(e,"click",function(){f.element.removeChild(d),f._updateContainer(),f.setupModules(c)}),d.appendChild(e),this.element.appendChild(d),this._updateContainer()},n.prototype.loadModule=function(a,b){var c=f.get(a);c&&c(this,b)},n.prototype.appendModHTML=function(a,b){var c=document.createElement("div");return c.className="octocard-m octocard-m-"+a.toLowerCase(),c.innerHTML=b,this.element.appendChild(c),c},n.prototype.createStyle=function(a){return b.createStyle(b.format(a,"#root-id","#"+this.elementId))},n.prototype.setupModules=function(a,c){function d(b){function d(){f.loadModule(a[e],function(){e++,h>e?d():(g&&g.end(),f._updateContainer(),c&&c())})}f.data=b;var e=0,h=a.length;d()}var f=this;if(f.config.data)return d(f.config.data),void 0;var g=e(this.element);f._updateContainer(),b.jsonp(this.config.api+"?mods="+a.join(",")+"&login="+this.username,d,function(b){g&&g.end(),f._showErrorMsg(b,a)})},n.prototype._createContainer=function(){var a=document.createElement("div");this.elementId+=(new Date).getTime(),a.id=this.elementId;var c=b.getShadowRoot(this.element);if(c)c.appendChild(a);else{var d=document.createElement("iframe");d.style.cssText="width:100%;height:0;position:relative;top:0;left:0;right:0;bottom:0;display:block;padding:0;margin:0;border:none;",d.frameBorder="0",this.element.appendChild(d);var e=d.contentDocument||d.contentWindow.document;e.open(),e.write(""),e.close(),e.body.style.cssText="overflow:hidden;margin:0;padding:0;",e.body.appendChild(a),this.doc=e,this.iframe=d}this.isIsolated=!0,this.element=a},n.prototype._updateContainer=function(){if(this.iframe){var a=navigator.userAgent;if(a.match(/iPhone/i)||a.match(/iPad/i)){var c=this.iframe.parentNode.offsetWidth;this.doc.body.style.width=c+"px"}var d=b.getPageHeight(this.doc);this.iframe.style.height=d+"px"}},n.prototype._bindSizeClass=function(){var a=this;if(b.addSizeClass(a.host,a.element),!a._binded){a._binded=!0;var c;b.bind(window,"resize",function(){c&&clearTimeout(c),c=setTimeout(function(){b.addSizeClass(a.host,a.element)},250)})}},window.octocard=function(a){return new n(a)};var o;if("object"==typeof OCTOCARD)o=OCTOCARD;else{var p=document.getElementsByTagName("script"),q=p[p.length-1];if(!q)return;o={name:"",modules:"",reposNum:"",reposIgnored:"",orgsNum:"",element:"",api:"",noIsolated:!1,noFooter:!1};for(var r in o)o[r]=q.getAttribute("data-"+r)}o.name&&new n(o)}();